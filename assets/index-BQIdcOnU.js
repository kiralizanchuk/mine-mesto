(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function o(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(r){if(r.ep)return;r.ep=!0;const s=o(r);fetch(r.href,s)}})();const R=e=>{e.classList.toggle("card__like-button_is-active")},K=e=>{e.remove()},G=()=>document.getElementById("card-template").content.querySelector(".card").cloneNode(!0),O=(e,{onPreviewPicture:t,onLikeIcon:o,onDeleteCard:n,userId:r})=>{const s=G(),a=s.querySelector(".card__like-button"),S=s.querySelector(".card__control-button_type_delete"),m=s.querySelector(".card__image"),w=s.querySelector(".card__like-count");return m.src=e.link,m.alt=e.name,s.querySelector(".card__title").textContent=e.name,w.textContent=e.likes.length,e.likes.some(z=>z._id===r)&&a.classList.add("card__like-button_is-active"),e.owner._id!==r?S.remove():n&&S.addEventListener("click",()=>n(s,e._id)),o&&a.addEventListener("click",()=>o(a,e._id,w)),t&&m.addEventListener("click",()=>t({name:e.name,link:e.link})),s},T=e=>{if(e.key==="Escape"){const t=document.querySelector(".popup_is-opened");u(t)}},y=e=>{e.classList.add("popup_is-opened"),document.addEventListener("keyup",T)},u=e=>{e.classList.remove("popup_is-opened"),document.removeEventListener("keyup",T)},Q=e=>{e.querySelector(".popup__close").addEventListener("click",()=>{u(e)}),e.addEventListener("mousedown",o=>{o.target.classList.contains("popup")&&u(e)})},X=(e,t,o,n)=>{const r=e.querySelector(`#${t.id}-error`);t.classList.add(n.inputErrorClass),r.textContent=o,r.classList.add(n.errorClass)},$=(e,t,o)=>{const n=e.querySelector(`#${t.id}-error`);t.classList.remove(o.inputErrorClass),n.classList.remove(o.errorClass),n.textContent=""},Y=(e,t,o)=>{if(t.validity.patternMismatch){const n=t.dataset.errorMessage;t.setCustomValidity(n)}else t.setCustomValidity("");t.validity.valid?$(e,t,o):X(e,t,t.validationMessage,o)},Z=e=>e.some(t=>!t.validity.valid),N=(e,t)=>{e.classList.add(t.inactiveButtonClass),e.disabled=!0},ee=(e,t)=>{e.classList.remove(t.inactiveButtonClass),e.disabled=!1},A=(e,t,o)=>{Z(e)?N(t,o):ee(t,o)},te=(e,t)=>{const o=Array.from(e.querySelectorAll(t.inputSelector)),n=e.querySelector(t.submitButtonSelector);A(o,n,t),o.forEach(r=>{r.addEventListener("input",()=>{Y(e,r,t),A(o,n,t)})})},oe=e=>{Array.from(document.querySelectorAll(e.formSelector)).forEach(o=>{te(o,e)})},b=(e,t)=>{const o=Array.from(e.querySelectorAll(t.inputSelector)),n=e.querySelector(t.submitButtonSelector);o.forEach(r=>{$(e,r,t)}),N(n,t)},c={baseUrl:"https://mesto.nomoreparties.co/v1/apf-cohort-202",headers:{authorization:"3146a419-2e48-4020-87f9-644482395290","Content-Type":"application/json"}},i=e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`),re=()=>fetch(`${c.baseUrl}/users/me`,{headers:c.headers}).then(i),F=()=>fetch(`${c.baseUrl}/cards`,{headers:c.headers}).then(i),ne=({name:e,about:t})=>fetch(`${c.baseUrl}/users/me`,{method:"PATCH",headers:c.headers,body:JSON.stringify({name:e,about:t})}).then(i),se=e=>fetch(`${c.baseUrl}/users/me/avatar`,{method:"PATCH",headers:c.headers,body:JSON.stringify({avatar:e})}).then(i),ce=({name:e,link:t})=>fetch(`${c.baseUrl}/cards`,{method:"POST",headers:c.headers,body:JSON.stringify({name:e,link:t})}).then(i),ae=e=>fetch(`${c.baseUrl}/cards/${e}`,{method:"DELETE",headers:c.headers}).then(i),ie=(e,t)=>fetch(`${c.baseUrl}/cards/likes/${e}`,{method:t?"DELETE":"PUT",headers:c.headers}).then(i),D=document.querySelector(".places__list"),q=document.querySelector(".popup_type_edit"),v=q.querySelector(".popup__form"),W=v.querySelector(".popup__input_type_name"),J=v.querySelector(".popup__input_type_description"),g=document.querySelector(".popup_type_new-card"),d=g.querySelector(".popup__form"),le=d.querySelector(".popup__input_type_card-name"),ue=d.querySelector(".popup__input_type_url"),E=document.querySelector(".popup_type_image"),P=E.querySelector(".popup__image"),de=E.querySelector(".popup__caption"),pe=document.querySelector(".profile__edit-button"),me=document.querySelector(".profile__add-button"),k=document.querySelector(".profile__title"),I=document.querySelector(".profile__description"),x=document.querySelector(".profile__image"),B=document.querySelector(".popup_type_edit-avatar"),f=B.querySelector(".popup__form"),_e=f.querySelector(".popup__input"),h=document.querySelector(".popup_type_info"),fe=h.querySelector(".popup__title"),l=h.querySelector(".popup__info"),ye=h.querySelector(".popup__text"),U=h.querySelector(".popup__list"),he=document.querySelector(".logo");let L=null;const V=({name:e,link:t})=>{P.src=t,P.alt=e,de.textContent=e,y(E)},j=(e,t)=>{ae(t).then(()=>{K(e)}).catch(o=>{console.log(o)})},p=(e,t,o="Сохранение...",n="Сохранить")=>{t?e.textContent=o:e.textContent=n},_=(e,t)=>{const n=document.getElementById("popup-info-definition-template").content.querySelector(".popup__info-item").cloneNode(!0);return n.querySelector(".popup__info-term").textContent=e,n.querySelector(".popup__info-description").textContent=t,n},Se=e=>{const o=document.getElementById("popup-info-user-preview-template").content.querySelector(".popup__list-item").cloneNode(!0);return o.textContent=e,o},M=e=>{const t=new Date(e),o={year:"numeric",month:"long",day:"numeric"};return t.toLocaleDateString("ru-RU",o)},ve=()=>{F().then(e=>{if(l.innerHTML="",U.innerHTML="",fe.textContent="Статистика пользователей",l.append(_("Всего карточек:",e.length)),e.length>0){const r=[...e].sort((S,m)=>new Date(S.createdAt)-new Date(m.createdAt)),s=r[0],a=r[r.length-1];l.append(_("Первая создана:",M(s.createdAt))),l.append(_("Последняя создана:",M(a.createdAt)))}const t={},o=new Set;e.forEach(r=>{const s=r.owner._id,a=r.owner.name;o.add(JSON.stringify({id:s,name:a})),t[s]=(t[s]||0)+1}),l.append(_("Всего пользователей:",o.size));const n=Math.max(...Object.values(t),0);l.append(_("Максимум карточек от одного:",n)),ye.textContent="Все пользователи:",Array.from(o).forEach(r=>{const s=JSON.parse(r);U.append(Se(s.name))}),y(h)}).catch(e=>{console.log(e)})},H=(e,t,o)=>{const n=e.classList.contains("card__like-button_is-active");ie(t,n).then(r=>{R(e),o.textContent=r.likes.length}).catch(r=>{console.log(r)})},Ce=e=>{e.preventDefault();const t=e.submitter;p(t,!0),ne({name:W.value,about:J.value}).then(o=>{k.textContent=o.name,I.textContent=o.about,u(q)}).catch(o=>{console.log(o)}).finally(()=>{p(t,!1)})},Le=e=>{e.preventDefault();const t=e.submitter;p(t,!0),se(_e.value).then(o=>{x.style.backgroundImage=`url(${o.avatar})`,f.reset(),u(B)}).catch(o=>{console.log(o)}).finally(()=>{p(t,!1)})},be=e=>{e.preventDefault();const t=e.submitter;p(t,!0,"Создание...","Создать"),ce({name:le.value,link:ue.value}).then(o=>{D.prepend(O(o,{onPreviewPicture:V,onLikeIcon:H,onDeleteCard:j,userId:L})),d.reset(),u(g)}).catch(o=>{console.log(o)}).finally(()=>{p(t,!1,"Создание...","Создать")})};v.addEventListener("submit",Ce);d.addEventListener("submit",be);f.addEventListener("submit",Le);he.addEventListener("click",ve);pe.addEventListener("click",()=>{W.value=k.textContent,J.value=I.textContent,b(v,C),y(q)});x.addEventListener("click",()=>{f.reset(),b(f,C),y(B)});me.addEventListener("click",()=>{d.reset(),b(d,C),y(g)});const qe=document.querySelectorAll(".popup");qe.forEach(e=>{Q(e)});const C={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};oe(C);Promise.all([F(),re()]).then(([e,t])=>{L=t._id,k.textContent=t.name,I.textContent=t.about,x.style.backgroundImage=`url(${t.avatar})`,e.forEach(o=>{D.append(O(o,{onPreviewPicture:V,onLikeIcon:H,onDeleteCard:j,userId:L}))})}).catch(e=>{console.log(e)});
